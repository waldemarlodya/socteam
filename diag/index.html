<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konva.js Interactive Puzzle Pieces</title>
    <script src="https://cdn.jsdelivr.net/npm/konva@8.3.4/konva.min.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; /* Заборона прокрутки */
        }
        #container {
            border: 1px solid #ddd;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <script>
        // Динамічний розмір сцени
        var containerWidth = window.innerWidth;
        var containerHeight = window.innerHeight;

        var stage = new Konva.Stage({
            container: 'container',
            width: containerWidth,
            height: containerHeight,
        });

        var layer = new Konva.Layer();
        stage.add(layer);

        var centerX = stage.width() / 2;
        var centerY = stage.height() / 2;

        function getResponsiveRadius(level) {
            const baseRadius = [80, 150, 230]; // Радіуси для PC
            const scaleFactor = Math.min(stage.width(), stage.height()) / 800; // Масштабування
            return baseRadius[level] * scaleFactor;
        }

        function getFontSize() {
            return Math.max(10, Math.min(20, stage.width() / 40));
        }

        function createPuzzlePiece(x, y, startAngle, endAngle, innerRadius, outerRadius, defaultColor) {
            var piece = new Konva.Arc({
                x: x,
                y: y,
                innerRadius: innerRadius,
                outerRadius: outerRadius,
                angle: endAngle - startAngle,
                rotation: startAngle,
                fill: '#cccccc',
                stroke: 'black',
                strokeWidth: 1,
            });

            var state = 0;
            function handleClick() {
                if (state === 0) {
                    piece.fill('rgba(0, 0, 0, 0)');
                    state = 1;
                } else if (state === 1) {
                    piece.fill(defaultColor);
                    state = 2;
                } else {
                    piece.fill('#cccccc');
                    state = 0;
                }
                layer.draw();
            }
            piece.on('click', handleClick);
            piece.on('touchstart', handleClick);

            return piece;
        }

        function createLevel(items, colors, level) {
            const innerRadius = getResponsiveRadius(level);
            const outerRadius = getResponsiveRadius(level) + 60;

            items.forEach((item, index) => {
                var startAngle = (index / items.length) * 360;
                var endAngle = ((index + 1) / items.length) * 360;

                var piece = createPuzzlePiece(centerX, centerY, startAngle, endAngle, innerRadius, outerRadius, colors[index]);
                layer.add(piece);

                var angle = (startAngle + endAngle) / 2;
                var textRadius = innerRadius + (outerRadius - innerRadius) / 2;

                var x = centerX + textRadius * Math.cos(Konva.Util.degToRad(angle));
                var y = centerY + textRadius * Math.sin(Konva.Util.degToRad(angle));

                var itemText = new Konva.Text({
                    x: x,
                    y: y,
                    text: item,
                    fontSize: getFontSize(),
                    fontFamily: 'Courier New',
                    fill: 'white',
                });

                itemText.offsetX(itemText.width() / 2);
                itemText.offsetY(itemText.height() / 2);
                layer.add(itemText);
            });
        }

        // Перший рівень
        createLevel(['Endpoint Sec', 'MFA', 'Patchmgm'], ['#FF6B6B', '#6BCB77', '#4D96FF'], 0);
        // Другий рівень
        createLevel(['Assessm.', 'Awareness', 'Audit', 'Pentest', 'Dark monitoring', 'Network'], 
            ['#FFD93D', '#FF7F3F', '#A77CFF', '#32E0C4', '#FF4D4D', '#1E90FF'], 1);
        // Третій рівень
        createLevel(['Sandbox', 'Deception', 'XDR', 'NTA', 'DLP', 'MDM', 'TI/YARA', 'IAM/PAM', 'WAF', 'OSINT'], 
            ['#FF9F1C', '#2EC4B6', '#E71D36', '#011627', '#FFBF69', '#CBF3F0', '#E63946', '#A8DADC', '#457B9D', '#1D3557'], 2);

        // Масштабування сцени при зміні розміру вікна
        window.addEventListener('resize', () => {
            stage.width(window.innerWidth);
            stage.height(window.innerHeight);
            centerX = stage.width() / 2;
            centerY = stage.height() / 2;

            layer.destroyChildren();
            createLevel(['Endpoint Sec', 'MFA', 'Patchmgm'], ['#FF6B6B', '#6BCB77', '#4D96FF'], 0);
            createLevel(['Assessm.', 'Awareness', 'Audit', 'Pentest', 'Dark monitoring', 'Network'], 
                ['#FFD93D', '#FF7F3F', '#A77CFF', '#32E0C4', '#FF4D4D', '#1E90FF'], 1);
            createLevel(['Sandbox', 'Deception', 'XDR', 'NTA', 'DLP', 'MDM', 'TI/YARA', 'IAM/PAM', 'WAF', 'OSINT'], 
                ['#FF9F1C', '#2EC4B6', '#E71D36', '#011627', '#FFBF69', '#CBF3F0', '#E63946', '#A8DADC', '#457B9D', '#1D3557'], 2);
            layer.draw();
        });
    </script>
</body>
</html>
